name: Update Dynamic Profile

on:
  schedule:
    - cron: "*/30 * * * *"  # Runs every 30 minutes
  workflow_dispatch:        # Allows manual testing

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Fetch Last 2 Active Repos
        run: |
          # Fetch repos sorted by 'pushed' (most recent code changes first) and limit to 2
          curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          "https://api.github.com/users/raymond-01/repos?sort=pushed&direction=desc&per_page=2" \
          | jq -r '.[] | "- [**\(.name)**](\(.html_url)) â€” \(.description // "No description provided.")"' > current_work.md

      - name: Update README
        run: |
          # Use sed to replace content between the markers
          sed -i '//,//{//!d}' README.md
          sed -i '//r current_work.md' README.md
          
          # Clean up
          rm current_work.md

      - name: Commit and push changes
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ”¥ Update active projects" && git push)
